{% extends "base.html" %}
{% load static %}

{% block head_extra_meta %}{# <meta> tags go here #}{% endblock %}

{% block head_css %}{# additional <link> tags for CSS #}{% endblock %}

{% block head_js %}{# <script defer> tags for deferred JS only #}{% endblock head_js %}

{% block head_title %}{# Page title. Base page has " | VentApp"; follow this pattern for sub-page titling #}{% endblock %}

{# Add classes to the main <div> wrapping body content #}
{% block body_container_classes %}mx-0 w-100 mw-100{% endblock %}

{% block body_content %}


<div class="container-fluid h-100">

   <div class="row mb-2"   >
      <div class= "col">


            <div class="btn-group" role="group" aria-label="Basic radio toggle button group" id  = "chart_type"> 

               <input type="radio" class="btn-check" name="btnradioChart" id="general" autocomplete="off"   checked >
               <label class="btn btn-outline-secondary" for="general"  onclick="changeDataChart({{general |safe}} ,  'general')" >General</label>


               <input type="radio" class="btn-check" name="btnradioChart" id="t_preassure" autocomplete="off" >
               <label class="btn btn-outline-secondary" for="t_preassure"  onclick="changeDataChart({{total_pressure |safe}},'t_preassure')" >Total Pressure</label>

               <input type="radio" class="btn-check" name="btnradioChart" id="s_pressure" autocomplete="off"  >
               <label class="btn btn-outline-secondary" for="s_pressure"    onclick="changeDataChart({{static_pressure|safe}}, 's_pressure')" >Static Pressure</label>

               <input type="radio" class="btn-check" name="btnradioChart" id="power" autocomplete="off" >
               <label class="btn btn-outline-secondary" for="power" onclick="changeDataChart({{power|safe}},'power')" >Power</label>

            </div>
      
            <div class = "row-4 mt-2">
            
               <div class="btn-group" role="group" aria-label="Basic radio toggle button group" id  = "fan_selector"> 
                  
                  
                     <input type="radio" class="btn-check" name="btnradioFan" id="f_performance" autocomplete="off"  checked >
                     <label class="d-flex btn btn-outline-secondary p-0 m-1" for="f_performance"  onclick="chartSwitch(true)"  > <div class="col-3 " id = 'fp_status' style= "background-color: {{ general.FanPerformance.status }};">  </div> <div class="col p-1 me-2"> Fan Performance</div> </label>
                  

                     <input type="radio" class="btn-check" name="btnradioFan" id="f_operation" autocomplete="off" >
                     <label class=" d-flex   btn btn-outline-secondary p-0 m-1"  for="f_operation" onclick="chartSwitch(false)" > <div class="col-3 " id = 'fo_status'  style= "background-color: {{ general.FanOperation.status }};">  </div> <div class="col p-1 me-2"> Fan Operation</div> </label>

               </div>
            
            </div>

      
      </div>

   

   </div>



      <div class="row " style="height: calc(100% - 40px);">
         <div class="col-9 border-end border-3 border-dark h-100">
               {% comment %} {% include "widgets/fanRealCurve/graphic.html" %} {% endcomment %}
               <div class="row">
                  <div class="col-2 d-flex">
                     <div class="col" style= "background-color: gray;"> Caudal Ventilador</div>
                     <div class="col" id="q1"></div>
                  </div>
                  <div class="col-2 d-flex">
                     <div class="col" style= "background-color: gray;"> Caudal Frente</div>
                     <div class="col" id="qf"></div>
                  </div>
                  <div class="col-2 d-flex">
                     <div class="col" style= "background-color: gray;"> Presión Ventilador</div>
                     <div class="col" id="pt1"></div>
                  </div>
                  
               </div> 
         </div>

         <div class="col-3">
            <div class="row justify-content-center align-items-center">
               <div class="col-12 col-md-10 col-xl-8">
                  {#  Model #}
                  <div class="list-group border border-3 border-warning p-3 mb-2">
                     <div class="row">
                        <p class="text-center fs-4 fw-bold m-0 ">Fan 1</p>
                     </div>
                  </div>
                  {#  Model #}
                  <div class="list-group border border-3 border-warning p-3 mb-2">
                     <div class="row">
                        <p class="text-start fs-5 m-0">JetStream AXT0800</p>
                     </div>
                  </div>
                  {#  Blade angle #}
                  <div class="list-group border border-3 border-warning p-3 mb-2">
                     <div class="row">
                        <p class="text-start fs-5 m-0">Density</p>
                        <p class="text-start fs-6  ps-4 m-1">&#8226; 1.08 kg/m&#179;</p>
                     </div>
                  </div>

               </div>
            </div>
         </div>
      </div>
   </div>

{% endblock %}


{% block body_js %}
{# Inline or other types of JS <script> tags here. #}
{# Remember we've already got jQuery and Bootstrap bundle with Popper loaded. #}
   <script src="{% static 'js/d3.v7.js' %}"></script>
   <script src="{% static 'js/scatterplot.js' %}"></script>

   <script type="text/javascript">
      
      var dataSection = {{ general| safe }};
      
      var sectionStatus = 'general'
      var switchStatus = true


      {% comment %} document.addEventListener("DOMContentLoaded", function() { createChartScatterplot(dataSection.FanPerformance.data); }); {% endcomment %}
      document.addEventListener("DOMContentLoaded", function() { getValues() });

      
      // Cambiar vista
      function changeChartType(type) {
         window.location.href = "{% url 'fanreal:fanreal' %}?chart_type=" + type;
      }
      
      function sectionSelector(section) {
         window.location.href = "{% url 'fanreal:fanreal' %}?section=" + section;
      }

      function changeDataChart(data_input, section){

      
         sectionStatus = section;
         dataSection = data_input;
         chartSwitch(switchStatus);

         var status = []

         var fPStatus = document.getElementById('fp_status');
         var fOStatus = document.getElementById('fo_status');

         fPStatus.style.backgroundColor = data_input.FanPerformance.status;
         fOStatus.style.backgroundColor = data_input.FanOperation.status;
         
      }


      function chartSwitch(fanSelector){

         switchStatus= fanSelector

         if (switchStatus == true){
            console.log(sectionStatus)
            updateData(dataSection.FanPerformance.data);

         }else{
            console.log(sectionStatus)
            updateData(dataSection.FanOperation.data);
         }
         
      }

      function getValues() {
         fetch("/get_recent_data")
            .then(response => response.json())
            .then(data => {
               // Información en data
               console.log(data);
               updateValues(data);
         });
      }

      function updateValues(data) {
         // Actualiza los divs con los nuevos valores  
         $("#q1").text(data[0]);  
         $("#qf").text(data[1]);
         $("#pt1").text(data[2]);
      }

      setInterval( () => {
         getValues();
      }, 15000);

   </script> 
{% endblock %}
